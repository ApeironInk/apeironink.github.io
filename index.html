<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style id="dynamic-styles">
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --bg-color: #050505;
            --text-color: #ffffff;
            --border-color: rgba(255, 211, 0, 0.35);
            --accent-color: #ffffff;
            --accent-text: #000000;
            --name-color: #F5F5F5;
            --name-shadow: rgba(0, 233, 255, 0.35);
            --grid-color: rgba(255, 0, 255, 0.03);
            --interactive-shadow: #FF00FF; 
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        #display-name {
            color: var(--name-color);
            transition: opacity 0.3s ease;
        }

        #avatar-box {
            background-color: var(--name-color);
            border-radius: 9999px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }

        .link-card {
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--text-color);
            transition: all 0.2s ease, filter 0s;
            cursor: pointer;
            width: 100%; /* Ocupa todo el ancho del contenedor w-fit */
        }

        .link-card:hover {
            background-color: var(--accent-color);
            color: var(--accent-text);
            border-color: var(--accent-color);
            transform: translateY(-3px);
            filter: drop-shadow(3px 3px 0px var(--interactive-shadow));
        }

        .link-card:active {
            transform: translateY(-1px);
            filter: drop-shadow(2px 2px 0px var(--interactive-shadow));
        }

        #identity-link:hover #avatar-box {
            transform: scale(1.05);
            filter: drop-shadow(3px 3px 0px var(--interactive-shadow));
        }

        .grid-bg {
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), 
                              linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        #config-panel::-webkit-scrollbar { width: 4px; }
        #config-panel::-webkit-scrollbar-thumb { background: #444; }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: black;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
    </style>
</head>
<body class="grid-bg">

    <div id="loading" class="loading-overlay">
        <div class="mono text-[10px] tracking-[0.5em] animate-pulse">SINCRONIZANDO...</div>
    </div>

    <!-- Panel de Gestión -->
    <div id="config-panel" class="fixed left-4 top-4 z-50 bg-neutral-900 border border-neutral-700 p-4 rounded-lg w-80 shadow-2xl transition-transform -translate-x-[22rem] hover:translate-x-0 overflow-y-auto max-h-[90vh]">
        <div class="flex justify-between items-center mb-6 border-b border-neutral-800 pb-2">
            <h3 class="text-[10px] font-bold uppercase mono text-neutral-400 tracking-tighter">Módulo de Control V.3.5 (Prod)</h3>
            <span class="text-[9px] bg-neutral-800 px-1 text-neutral-500">Alt + C</span>
        </div>
        
        <div class="space-y-6">
            <div class="space-y-2">
                <p class="text-[9px] uppercase font-bold text-neutral-500 mb-2">Esquema Cromático Global</p>
                <div class="grid grid-cols-2 gap-2">
                    <div class="flex items-center justify-between bg-black/40 p-1.5 rounded border border-neutral-800">
                        <label class="text-[9px] uppercase mono">Fondo</label>
                        <input type="color" id="clr-bg" value="#050505" oninput="updateUI()">
                    </div>
                    <div class="flex items-center justify-between bg-black/40 p-1.5 rounded border border-neutral-800">
                        <label class="text-[9px] uppercase mono">Texto</label>
                        <input type="color" id="clr-text" value="#ffffff" oninput="updateUI()">
                    </div>
                    <div class="flex items-center justify-between bg-black/40 p-1.5 rounded border border-neutral-800">
                        <label class="text-[9px] uppercase mono">Borde</label>
                        <input type="color" id="clr-border" value="#FFD300" oninput="updateUI()">
                    </div>
                    <div class="flex items-center justify-between bg-black/40 p-1.5 rounded border border-neutral-800">
                        <label class="text-[9px] uppercase mono">Acento</label>
                        <input type="color" id="clr-accent" value="#ffffff" oninput="updateUI()">
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <p class="text-[9px] uppercase font-bold text-neutral-500 border-b border-neutral-800 pb-1">Identidad Visual</p>
                <div class="space-y-2">
                    <input type="text" id="cfg-name" class="w-full bg-black border border-neutral-700 text-xs p-2 rounded focus:border-white outline-none" placeholder="APEIRON.INK" value="APEIRON.INK" oninput="updateUI()">
                    <input type="text" id="cfg-id" class="w-full bg-black border border-neutral-700 text-xs p-2 rounded focus:border-white outline-none" placeholder="IDENTIFICADOR" value="BLACKWORK ILUSTRATIVO" oninput="updateUI()">
                    <label class="text-[9px] uppercase mono text-neutral-500">Enlace de Cabecera</label>
                    <input type="text" id="cfg-main-link" class="w-full bg-black border border-neutral-700 text-xs p-2 rounded focus:border-white outline-none" placeholder="https://..." value="https://www.instagram.com/apeiron.ink/" oninput="updateUI()">
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex items-center justify-between border-b border-neutral-800 pb-1">
                    <p class="text-[9px] uppercase font-bold text-neutral-500">Botonera de Enlaces</p>
                    <button onclick="addNewLink()" class="text-[9px] bg-neutral-800 hover:bg-neutral-700 px-2 py-0.5 rounded mono transition-colors">+ Añadir</button>
                </div>
                <div id="links-editor" class="space-y-3"></div>
            </div>
            
            <button id="save-btn" onclick="saveData()" class="w-full bg-white text-black font-bold text-[10px] py-3 uppercase hover:bg-neutral-300 transition-colors mono tracking-widest">Guardar Cambios</button>
            <div id="status-msg" class="text-[8px] mono text-center uppercase text-neutral-500 h-4"></div>
        </div>
    </div>

    <!-- Interfaz Principal -->
    <main class="flex-grow flex flex-col items-center justify-center p-6">
        <!-- Contenedor con ancho ajustado al ID -->
        <div class="w-fit mx-auto text-center flex flex-col items-stretch">
            
            <a id="identity-link" 
               onmouseenter="randomizeShadow(this)" 
               onpointerdown="randomizeShadow(this)" 
               href="https://www.instagram.com/apeiron.ink/" 
               target="_blank" 
               class="block mb-12 group no-underline outline-none">
                <div id="avatar-box" class="w-16 h-16 mx-auto mb-6 flex items-center justify-center">
                    <i data-lucide="binary" class="text-black w-8 h-8" id="avatar-icon"></i>
                </div>
                <h1 id="display-name" class="text-3xl font-bold tracking-tighter uppercase mb-2">APEIRON.INK</h1>
                <p id="display-id" class="mono text-[10px] tracking-[0.3em] text-neutral-500 uppercase border-y border-neutral-900 py-2 px-4">BLACKWORK ILUSTRATIVO</p>
            </a>

            <!-- El contenedor de enlaces ahora se expande al ancho del ID -->
            <div id="links-container" class="space-y-3 flex flex-col items-stretch"></div>

        </div>
    </main>

    <footer class="p-12 text-center">
        <p class="mono text-[10px] text-neutral-600 uppercase tracking-[0.3em]">
            citas por instagram o whatsapp
        </p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- GESTIÓN DE ENTORNO ---
        const isCanvasEnv = typeof __firebase_config !== 'undefined';
        let db = null;
        let auth = null;
        let appId = 'nexus-standalone';

        if (isCanvasEnv) {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            } catch (e) {
                console.warn("Nexus: Error en inicialización de Firebase.");
            }
        }

        let appState = {
            name: "APEIRON.INK",
            idTag: "BLACKWORK ILUSTRATIVO",
            mainLink: "https://www.instagram.com/apeiron.ink/",
            colors: { bg: "#050505", text: "#ffffff", border: "rgba(255, 211, 0, 0.35)", accent: "#ffffff" },
            links: [
                { title: "Instagram (portfolio)", url: "https://www.instagram.com/apeiron.ink/" },
                { title: "Whatsapp", url: "https://wa.me/message/4SLJ2CDOJ5RND1" },
                { title: "TikTok", url: "https://www.tiktok.com/@apeiron.ink?_r=1&_t=ZN-9420kon7vs6" }
            ]
        };

        const removeLoading = () => {
            const loader = document.getElementById('loading');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 500);
            }
        };

        window.randomizeShadow = (el) => {
            const colors = ['#00E9FF', '#FF00FF', '#FFD300'];
            const chosen = colors[Math.floor(Math.random() * colors.length)];
            el.style.setProperty('--interactive-shadow', chosen);
        };

        window.updateUI = () => {
            const root = document.documentElement;
            const bgVal = document.getElementById('clr-bg').value;
            const textVal = document.getElementById('clr-text').value;
            const borderVal = document.getElementById('clr-border').value;
            const accentVal = document.getElementById('clr-accent').value;

            root.style.setProperty('--bg-color', bgVal);
            root.style.setProperty('--text-color', textVal);
            
            if (borderVal.startsWith('#')) {
                const r = parseInt(borderVal.slice(1, 3), 16);
                const g = parseInt(borderVal.slice(3, 5), 16);
                const b = parseInt(borderVal.slice(5, 7), 16);
                root.style.setProperty('--border-color', `rgba(${r}, ${g}, ${b}, 0.35)`);
            } else {
                root.style.setProperty('--border-color', borderVal);
            }
            
            root.style.setProperty('--accent-color', accentVal);
            root.style.setProperty('--accent-text', bgVal);

            const avatarIcon = document.getElementById('avatar-icon');
            if(avatarIcon) avatarIcon.style.color = '#000000';

            const name = document.getElementById('cfg-name').value || "APEIRON.INK";
            const idTag = document.getElementById('cfg-id').value || "ID";
            const mainLink = document.getElementById('cfg-main-link').value || "#";

            document.getElementById('display-name').innerText = name;
            document.getElementById('display-id').innerText = idTag;
            document.getElementById('identity-link').href = mainLink;

            const titleInputs = document.querySelectorAll('.link-title-in');
            const urlInputs = document.querySelectorAll('.link-url-in');
            if (titleInputs.length > 0) {
                appState.links = Array.from(titleInputs).map((input, i) => ({
                    title: input.value,
                    url: urlInputs[i].value
                }));
            }
            renderLinks();
        };

        const renderLinks = () => {
            const container = document.getElementById('links-container');
            if(!container) return;
            container.innerHTML = appState.links.map(link => `
                <a href="${link.url}" 
                   target="_blank" 
                   onmouseenter="randomizeShadow(this)"
                   onpointerdown="randomizeShadow(this)"
                   class="link-card block py-4 px-6 text-[11px] mono uppercase font-bold tracking-widest no-underline">
                    ${link.title}
                </a>
            `).join('');
        };

        window.renderEditor = () => {
            const editor = document.getElementById('links-editor');
            if(!editor) return;
            editor.innerHTML = appState.links.map((link, index) => `
                <div class="bg-black/20 p-2 border border-neutral-800 rounded relative group">
                    <button onclick="removeLink(${index})" class="absolute -right-1 -top-1 bg-red-900 text-white w-4 h-4 rounded-full text-[8px] flex items-center justify-center">✕</button>
                    <div class="flex flex-col gap-1">
                        <input type="text" class="link-title-in bg-transparent border-b border-neutral-800 text-[10px] p-1 text-neutral-300 outline-none" value="${link.title}" oninput="updateUI()">
                        <input type="text" class="link-url-in bg-transparent text-[9px] p-1 text-neutral-500 outline-none" value="${link.url}" oninput="updateUI()">
                    </div>
                </div>
            `).join('');
        };

        window.addNewLink = () => {
            appState.links.push({ title: "NUEVO ENLACE", url: "https://" });
            renderEditor();
            updateUI();
        };

        window.removeLink = (index) => {
            appState.links.splice(index, 1);
            renderEditor();
            updateUI();
        };

        window.saveData = async () => {
            if (!auth || !auth.currentUser) return;
            const btn = document.getElementById('save-btn');
            const status = document.getElementById('status-msg');
            btn.disabled = true;
            btn.innerText = "SUBIENDO...";

            const finalState = {
                name: document.getElementById('cfg-name').value,
                idTag: document.getElementById('cfg-id').value,
                mainLink: document.getElementById('cfg-main-link').value,
                colors: {
                    bg: document.getElementById('clr-bg').value,
                    text: document.getElementById('clr-text').value,
                    border: document.getElementById('clr-border').value,
                    accent: document.getElementById('clr-accent').value
                },
                links: appState.links
            };

            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'config', 'settings'), finalState);
                status.innerText = "SINCRO NUBE OK";
                setTimeout(() => status.innerText = "", 3000);
            } catch (e) {
                status.innerText = "ERROR NUBE";
            } finally {
                btn.disabled = false;
                btn.innerText = "Guardar Cambios";
            }
        };

        const loadCloudData = async (user) => {
            if (!user || !db) return;
            try {
                const docSnap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'config', 'settings'));
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('cfg-name').value = data.name || "APEIRON.INK";
                    document.getElementById('cfg-id').value = data.idTag || "BLACKWORK ILUSTRATIVO";
                    document.getElementById('cfg-main-link').value = data.mainLink || "https://www.instagram.com/apeiron.ink/";
                    document.getElementById('clr-bg').value = data.colors?.bg || "#050505";
                    document.getElementById('clr-text').value = data.colors?.text || "#ffffff";
                    document.getElementById('clr-border').value = data.colors?.border || "#FFD300";
                    document.getElementById('clr-accent').value = data.colors?.accent || "#ffffff";
                    appState.links = data.links || [];
                    updateUI();
                    renderEditor();
                }
            } catch (e) {
                console.warn("Nexus: No se pudo conectar con la nube.");
            } finally {
                removeLoading();
            }
        };

        renderLinks();
        renderEditor();
        
        if (isCanvasEnv && auth) {
            onAuthStateChanged(auth, (user) => {
                if (user) loadCloudData(user);
                else {
                    if (typeof __initial_auth_token !== 'undefined') signInWithCustomToken(auth, __initial_auth_token);
                    else signInAnonymously(auth);
                }
            });
        } else {
            setTimeout(removeLoading, 500); 
        }

        window.addEventListener('keydown', (e) => {
            if (e.altKey && e.key.toLowerCase() === 'c') {
                const panel = document.getElementById('config-panel');
                if(panel){
                    panel.classList.toggle('-translate-x-[22rem]');
                    panel.classList.toggle('translate-x-0');
                }
            }
        });

        lucide.createIcons();
    </script>
</body>
</html>
